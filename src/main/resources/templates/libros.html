<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca - Lectio</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{
          font-family:'Poppins',sans-serif;
          display:flex;
          min-height:100vh;
          background:linear-gradient(135deg,#e8f8f5 0%,#fdfdfd 100%);
          color:#2c3e50;
          padding-right: 290px;
          overflow-x:hidden;
        }

        main{
          flex:1;
          text-align:center;
          padding: 40px;
          position:relative;
          overflow:hidden;
        }
        h1{
          color:#27ae60;
          font-size:2.2rem;
          margin-bottom:40px;
          text-shadow:0 1px 3px rgba(0,0,0,0.1);
        }
        .libros-grid{
          display:flex;
          flex-wrap:wrap;
          justify-content:center;
          gap:40px;
          position:relative;
          z-index:2;
        }

        .libro{
          background:rgba(255,255,255,0.9);
          border-radius:16px;
          box-shadow:0 4px 15px rgba(0,0,0,0.08);
          width:200px;
          padding:15px;
          text-align:center;
          cursor:pointer;
          transition:transform 0.3s ease, box-shadow 0.3s ease;
          backdrop-filter:blur(6px);
          position:relative;
        }
        .libro:hover{
          transform:translateY(-8px);
          box-shadow:0 8px 20px rgba(0,0,0,0.12);
        }
        .libro.completado{
          border: 3px solid #27ae60;
        }
        .libro img{
          width:100%;
          height:260px;
          object-fit:cover;
          border-radius:12px;
          box-shadow:0 3px 10px rgba(0,0,0,0.1);
        }
        .libro h3{
          margin-top:12px;
          color:#2c3e50;
          font-size:1rem;
          font-weight:600;
        }

        .badge-completado{
          position:absolute;
          top:10px;
          right:10px;
          background:#27ae60;
          color:white;
          padding:6px 12px;
          border-radius:20px;
          font-size:0.75rem;
          font-weight:600;
          box-shadow:0 2px 8px rgba(39,174,96,0.4);
        }

        .progreso-section{
          margin-top:60px;
          background:rgba(255,255,255,0.95);
          border-radius:20px;
          padding:30px;
          box-shadow:0 8px 25px rgba(0,0,0,0.1);
          position:relative;
          z-index:2;
          backdrop-filter:blur(10px);
          border:2px solid #27ae60;
        }

        .progreso-title{
          color:#27ae60;
          font-size:1.8rem;
          margin-bottom:25px;
          font-weight:700;
        }

        .stats-cards{
          display:grid;
          grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
          gap:20px;
          margin-bottom:30px;
        }

        .stat-card{
          background:linear-gradient(135deg,#27ae60,#2ecc71);
          color:white;
          padding:20px;
          border-radius:15px;
          text-align:center;
          box-shadow:0 4px 15px rgba(39,174,96,0.3);
          transition:transform 0.3s ease;
        }

        .stat-card:hover{
          transform:translateY(-5px);
        }

        .stat-number{
          font-size:2.5rem;
          font-weight:700;
          margin-bottom:5px;
        }

        .stat-label{
          font-size:0.95rem;
          opacity:0.95;
        }

        .progreso-table{
          background:white;
          border-radius:15px;
          overflow:hidden;
          box-shadow:0 4px 15px rgba(0,0,0,0.05);
        }

        .table-header{
          background:#27ae60;
          color:white;
          padding:15px;
          font-weight:600;
          text-align:center;
        }

        .table-row{
          display:grid;
          grid-template-columns:50px 1fr 120px 120px;
          align-items:center;
          padding:15px;
          border-bottom:1px solid #ecf0f1;
          transition:background 0.3s ease;
        }

        .table-row:hover{
          background:#f8f9fa;
        }

        .table-row:last-child{
          border-bottom:none;
        }

        .book-icon{
          font-size:2rem;
          text-align:center;
        }

        .book-info h3{
          color:#2c3e50;
          font-size:1.1rem;
          margin-bottom:3px;
          text-align:left;
        }

        .book-info p{
          color:#7f8c8d;
          font-size:0.9rem;
          text-align:left;
        }

        .progress-bar-container{
          background:#ecf0f1;
          border-radius:10px;
          height:10px;
          overflow:hidden;
          position:relative;
        }

        .progress-bar{
          background:linear-gradient(90deg,#27ae60,#2ecc71);
          height:100%;
          border-radius:10px;
          transition:width 0.5s ease;
          box-shadow:0 0 10px rgba(39,174,96,0.5);
        }

        .status-badge{
          padding:6px 15px;
          border-radius:20px;
          font-size:0.85rem;
          font-weight:600;
          text-align:center;
          white-space:nowrap;
        }

        .status-completado{
          background:#27ae60;
          color:white;
        }

        .status-en-progreso{
          background:#f39c12;
          color:white;
        }

        .status-sin-empezar{
          background:#95a5a6;
          color:white;
        }

        .no-progress{
          text-align:center;
          padding:40px;
          color:#7f8c8d;
          font-size:1.1rem;
        }

        aside{
          width:250px;
          background:linear-gradient(180deg,#2ecc71,#27ae60);
          padding:30px 20px;
          display:flex;
          flex-direction:column;
          justify-content:space-between;
          box-shadow:-4px 0 20px rgba(0,0,0,0.1);
          border-radius:25px 0 0 25px;
          z-index:10;
          position:fixed;
          top:0;
          right:0;
          height:100vh;
          overflow-y:auto;
        }
        aside h2{
          text-align:center;
          color:#fff;
          margin-bottom:30px;
          font-weight:700;
          font-size:1.6rem;
          letter-spacing:1px;
        }
        aside ul{list-style:none;padding:0;}
        aside li{
          margin:18px 0;
          cursor:pointer;
          color:#fff;
          font-weight:500;
          font-size:1.05rem;
          padding:10px 15px;
          border-radius:12px;
          transition:all 0.3s ease;
          background:rgba(255,255,255,0.1);
        }
        aside li:hover{
          background:rgba(255,255,255,0.25);
          transform:translateX(-4px);
        }
        .footer{
          text-align:center;
          color:#ecf0f1;
          font-size:0.85rem;
          padding-top:10px;
          opacity:0.9;
        }

        .burbuja{
          position:absolute;
          background:radial-gradient(circle at 30% 30%, rgba(39,174,96,0.5), rgba(39,174,96,0.15));
          border-radius:50%;
          opacity:0.8;
          bottom:-120px;
          animation:flotar 8s linear infinite;
        }
        @keyframes flotar{
          0%{transform:translateY(0) scale(0.8);opacity:0;}
          10%{opacity:0.7;}
          50%{transform:translateY(-50vh) scale(1);opacity:1;}
          100%{transform:translateY(-110vh) scale(1.2);opacity:0;}
        }

        @media (max-width:768px){
          .table-row{
            grid-template-columns:40px 1fr;
            gap:10px;
          }
          .progress-bar-container,.status-badge{
            grid-column:2;
          }
        }
    </style>
</head>
<body>

<main>
    <h1>Selecciona un libro</h1>
    <div class="libros-grid">
        <div class="libro" data-libro="principito" onclick="window.location.href='desafio_principito'">
            <img src="images/principito.jpg" alt="El Principito">
            <h3>El Principito</h3>
        </div>
        <div class="libro" data-libro="1984" onclick="window.location.href='desafio_1984'">
            <img src="images/1984.jpg" alt="1984">
            <h3>1984</h3>
        </div>
        <div class="libro" data-libro="harrypotter" onclick="window.location.href='desafio_harrypotter'">
            <img src="images/harrypotter.jpg" alt="Harry Potter">
            <h3>Harry Potter</h3>
        </div>
    </div>

    <div class="progreso-section" id="progreso-section">
        <h2 class="progreso-title">üìä Tu Progreso de Lectura</h2>

        <div class="stats-cards" id="stats-cards"></div>

        <div class="progreso-table">
            <div class="table-header">Progreso Detallado por Libro</div>
            <div id="tabla-progreso"></div>
        </div>
    </div>

    <div class="burbuja" style="width:80px;height:80px;left:10%;animation-delay:1s;"></div>
    <div class="burbuja" style="width:100px;height:100px;left:25%;animation-delay:2.5s;"></div>
    <div class="burbuja" style="width:60px;height:60px;left:45%;animation-delay:1.5s;"></div>
    <div class="burbuja" style="width:120px;height:120px;left:65%;animation-delay:0.8s;"></div>
    <div class="burbuja" style="width:90px;height:90px;left:85%;animation-delay:3s;"></div>
</main>

<aside>
    <div>
        <h2>LECTIO</h2>
        <ul>
            <li onclick="window.location.href='index'">üè† Inicio</li>
            <li onclick="window.location.href='historia_pensamiento'">üí° Historia del Pensamiento</li>
            <li onclick="window.location.href='/api/logiado'">üè† Volver a Lectio</li>
        </ul>
    </div>
    <div class="footer">¬© 2025 Lectio</div>
</aside>

<script>
    const LIBROS_INFO = {
        'principito': { nombre: 'El Principito', icono: 'üåü', capitulos: 5 },
        '1984': { nombre: '1984', icono: 'üëÅÔ∏è', capitulos: 5 },
        'harrypotter': { nombre: 'Harry Potter', icono: '‚ö°', capitulos: 5 }
    };

    async function cargarProgreso() {
        try {
            const response = await fetch('/api/progreso/mi-progreso', {
                method: 'GET',
                credentials: 'include'
            });

            if (!response.ok) {
                mostrarSinProgreso();
                return;
            }

            const progreso = await response.json();
            mostrarEstadisticas(progreso);
            mostrarTablaProgreso(progreso);
            marcarLibrosCompletados(progreso);

        } catch (error) {
            console.error('Error cargando progreso:', error);
            mostrarSinProgreso();
        }
    }

    function mostrarSinProgreso() {
        document.getElementById('stats-cards').innerHTML = `
            <div class="no-progress">
                <p>üìñ A√∫n no has comenzado ning√∫n libro. ¬°Empieza a leer para ver tu progreso!</p>
            </div>
        `;
        document.getElementById('tabla-progreso').innerHTML = '';
    }

    function mostrarEstadisticas(progreso) {
        const totalLibros = Object.keys(LIBROS_INFO).length;
        const porcentaje = totalLibros > 0 ? Math.round((progreso.totalLibrosLeidos / totalLibros) * 100) : 0;

        document.getElementById('stats-cards').innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${progreso.totalLibrosLeidos}</div>
                <div class="stat-label">Libros Completados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${progreso.puntos}</div>
                <div class="stat-label">Puntos Ganados üèÜ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${porcentaje}%</div>
                <div class="stat-label">Progreso Total</div>
            </div>
        `;
    }

    function mostrarTablaProgreso(progreso) {
        let html = '';

        Object.keys(LIBROS_INFO).forEach(libroId => {
            const libro = LIBROS_INFO[libroId];
            const completado = progreso.librosCompletados.includes(libroId);

            const capitulosCompletados = progreso.capitulosPorLibro && progreso.capitulosPorLibro[libroId]
                ? progreso.capitulosPorLibro[libroId].length
                : 0;

            const porcentaje = (capitulosCompletados / libro.capitulos) * 100;

            let statusClass, statusText;
            if (completado) {
                statusClass = 'status-completado';
                statusText = '‚úì Completado';
            } else if (capitulosCompletados > 0) {
                statusClass = 'status-en-progreso';
                statusText = `${capitulosCompletados}/${libro.capitulos} caps`;
            } else {
                statusClass = 'status-sin-empezar';
                statusText = 'Sin empezar';
            }

            html += `
                <div class="table-row">
                    <div class="book-icon">${libro.icono}</div>
                    <div class="book-info">
                        <h3>${libro.nombre}</h3>
                        <p>${capitulosCompletados} de ${libro.capitulos} cap√≠tulos</p>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${porcentaje}%"></div>
                    </div>
                    <div class="status-badge ${statusClass}">${statusText}</div>
                </div>
            `;
        });

        document.getElementById('tabla-progreso').innerHTML = html;
    }

    function marcarLibrosCompletados(progreso) {
        progreso.librosCompletados.forEach(libroId => {
            const card = document.querySelector(`[data-libro="${libroId}"]`);
            if (card) {
                card.classList.add('completado');

                if (!card.querySelector('.badge-completado')) {
                    const badge = document.createElement('div');
                    badge.className = 'badge-completado';
                    badge.textContent = '‚úì Completado';
                    card.appendChild(badge);
                }
            }
        });
    }

    window.onload = cargarProgreso;
</script>

</body>
</html>